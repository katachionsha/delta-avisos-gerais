<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Avisos Gerais</title>
<style>
  body { font-family: Arial, sans-serif; background: #f5f5f5; margin: 0; padding: 0; }
  header { background: #0073e6; color: white; padding: 1rem; text-align: center; }
  main { padding: 1rem; max-width: 800px; margin: auto; }
  article { background: white; padding: 1rem; margin-bottom: 1rem; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
  h2 { margin-top: 0; }
  .data { color: #555; font-size: 0.9rem; margin-bottom: 0.5rem; }
  img { max-width: 100%; height: auto; margin-top: 0.5rem; border-radius: 5px; }
  a { color: #0073e6; word-break: break-word; display: block; margin-top: 0.5rem; }
</style>
</head>
<body>

<header>
  <h1>Avisos Gerais</h1>
</header>

<main id="avisos-container">
  <p>Carregando avisos...</p>
</main>

<script>
const workerUrl = 'https://delta-helper-avisosgerais-cloudfare.katachionsha.workers.dev/';

async function carregarAvisos() {
  const container = document.getElementById('avisos-container');
  container.innerHTML = '<p>Carregando avisos...</p>';

  try {
    const res = await fetch(workerUrl);
    if (!res.ok) throw new Error('Falha ao buscar avisos');
    const data = await res.json();

    container.innerHTML = '';
    data.avisos.forEach(aviso => {
      const article = document.createElement('article');

      // Título
      const titulo = document.createElement('h2');
      titulo.textContent = aviso.titulo;
      article.appendChild(titulo);

      // Data
      const dataElem = document.createElement('div');
      dataElem.className = 'data';
      const dataObj = new Date(aviso.data);
      dataElem.textContent = dataObj.toLocaleString('pt-BR', { dateStyle: 'short', timeStyle: 'short' });
      article.appendChild(dataElem);

      // Texto
      const texto = document.createElement('div');
      texto.innerHTML = aviso.texto;
      article.appendChild(texto);

      // Arquivos
      if (aviso.arquivos && aviso.arquivos.length > 0) {
        aviso.arquivos.forEach(arq => {
          const ext = arq.split('.').pop().toLowerCase();
          const fileUrl = `https://service.deltasge.net/storage/${arq}`;
          if (ext === 'pdf') {
            const link = document.createElement('a');
            link.href = fileUrl;
            link.target = '_blank';
            link.textContent = 'Abrir PDF: ' + arq;
            article.appendChild(link);
          } else {
            const img = document.createElement('img');
            img.src = fileUrl;
            img.alt = arq;
            article.appendChild(img);
          }
        });
      }

      // Links
      if (aviso.links && aviso.links.length > 0) {
        aviso.links.forEach(l => {
          const a = document.createElement('a');
          a.href = l;
          a.target = '_blank';
          a.textContent = l;
          article.appendChild(a);
        });
      }

      container.appendChild(article);
    });

  } catch (err) {
    console.error(err);
    container.innerHTML = `<p>Erro ao carregar avisos: ${err.message}</p>`;
  }
}

// Carrega ao abrir a página
carregarAvisos();
</script>

</body>
</html>
